var config={apiKey:"AIzaSyBxIPdeGPLqs1BMGDjdVb_NGIggAskpT0s",authDomain:"test-907e1.firebaseapp.com",databaseURL:"https://test-907e1.firebaseio.com",projectId:"test-907e1",storageBucket:"",messagingSenderId:"119635730149"};firebase.initializeApp(config);var provider=new firebase.auth.GoogleAuthProvider;firebase.auth().useDeviceLanguage();const txtEmail=document.getElementById("txtEmail"),txtPassword=document.getElementById("txtPassword"),btnLogin=document.getElementById("btnLogin"),btnSignUp=document.getElementById("btnSignUp"),btnTEST=document.getElementById("btnTEST"),txtName=document.getElementById("txtName"),txtMessage=document.getElementById("txtMessage"),btnUpdateName=document.getElementById("btnUpdateName"),btnSignUpWithGoogle=document.getElementById("btnSignUpWithGoogle");var mess;btnLogin.addEventListener("click",()=>{console.log("TEST");const b=txtEmail.value,c=txtPassword.value,d=firebase.auth(),f=d.signInWithEmailAndPassword(b,c);f.catch(g=>{console.log(g.messsage),$(document).ready(function(){$("#logFailedAlert").slideDown().delay("100").slideUp()})})});var userID;btnSignUp.addEventListener("click",()=>{const b=txtEmail.value,c=txtPassword.value,d=firebase.auth(),f=d.createUserWithEmailAndPassword(b,c);f.catch(g=>{console.log(g.messsage),$(document).ready(function(){$("#logFailedAlert").slideDown().delay("100").slideUp()})})}),btnSignUpWithGoogle.addEventListener("click",()=>{firebase.auth().signInWithRedirect(provider),firebase.auth().getRedirectResult().then().catch(function(b){console.log(b),$(document).ready(function(){$("#logFailedAlert").slideDown().delay("100").slideUp()})})});const refObj=firebase.database().ref(),uploadedAlert=document.getElementById("uploadedAlert");var code;function uploadCode(){var a=window.location.search.substring(1).split("&");console.log(a);for(var c,b=0;b!=a.length;b++)c=a[b].split("="),"code"==c[0]&&(console.log(c[1]),code=c[1],console.log(userID),console.log("# of keys: "+numOfKeys),null==userID?($(document).ready(function(){$("#notSignedInAlert").fadeIn()}),console.log("Update blocked due to lack of userID"),NoUID=!0):refObj.child("users_codes").child(userID).once("value",d=>{console.log(d.exists()),d.exists()&&null!=d.val()[code]?$(document).ready(function(){$("#notSignedInAlert").slideUp(),$("#alreadyScannedAlert").slideDown().delay("3000").slideUp()}):(console.log("RAN"),refObj.child("users_codes").child(userID).update({[code]:!0}),$(document).ready(function(){$("#notSignedInAlert").slideUp(),$("#uploadedAlert").slideDown().delay("3000").slideUp()}))}))}document.getElementById("signOutLink").onclick=function(){console.log("Sign out"),firebase.auth().signOut()};var NoUID=!1,displayName,numOfKeys=0;firebase.auth().onAuthStateChanged(a=>{a?(console.log(a),txtEmail.value=a.email,document.getElementById("signedInP").style.display="inline",document.getElementById("signedInP").style.fontSize="x-small",document.getElementById("insertNameHere").innerHTML=a.email,document.getElementById("signInForm").style.display="none",document.getElementById("updateInfoForm").style.display="block",document.getElementById("welcomeMessageOnJumbo").innerHTML="You are now signed in!",$(document).ready(function(){$("#jumbo").slideUp()}),userID=a.uid,NoUID&&uploadCode(),console.log(a.displayName),displayName=a.displayName):(console.log("not logged in!"),document.getElementById("signedInP").style.display="none",document.getElementById("signInForm").style.display="block",document.getElementById("updateInfoForm").style.display="none",document.getElementById("jumbo").style.display="block")});var first=!0;refObj.child("users").on("value",a=>{var b=[],c=0;for(var d in a.val())if(a.val().hasOwnProperty(d)){for(var f in b.push({}),a.val()[d])a.val()[d].hasOwnProperty(f)&&("Name"==f?b[c].name=a.val()[d][f]:"Message"==f?b[c].message=a.val()[d][f]:"numOfCodes"==f&&(b[c].numOfKeys=a.val()[d][f]));null==b[c].numOfKeys&&(b[c].numOfKeys=0),d==userID&&(console.log(d),numOfKeys=b[c].numOfKeys,document.getElementById("insertNumberOfCodesHere").innerHTML=null==b[c].numOfKeys?"":b[c].numOfKeys,null!=b[c].name&&(txtName.value=b[c].name),null!=b[c].message&&(txtMessage.value=b[c].message),b[c].user=!0,(null==b[c].name||null==b[c].message)&&($(document).ready(function(){$("#NoNameMessage").slideDown().delay("6000").slideUp()}),console.log(displayName),null!=displayName&&(refObj.child("users").child(userID).update({Name:displayName}),b[c].name=displayName))),c++}first&&(first=!1,uploadCode());for(var g=1;g<b.length;g++){for(var h=b[g],k=g-1;0<=k&&b[k].numOfKeys<h.numOfKeys;)b[k+1]=b[k],k--;b[k+1]=h}const l=document.getElementById("myTable");for(;2<l.rows.length;)l.deleteRow(-1);for(var m=-1,n=0,g=0;g<b.length;g++){const o=l.insertRow(-1),p=o.insertCell(0),q=o.insertCell(1),r=o.insertCell(2),s=o.insertCell(3);m!=b[g].numOfKeys&&n++,m=b[g].numOfKeys,p.innerHTML=n,null==b[g].name||(q.innerHTML=b[g].name),null==b[g].message||(r.innerHTML=b[g].message),s.innerHTML=b[g].numOfKeys,1==n,!0==b[g].user&&(o.className="table-primary")}l.deleteRow(1)}),btnUpdateName.addEventListener("click",()=>{console.log(userID),refObj.child("users").child(userID).update({Name:txtName.value,Message:txtMessage.value}),$(document).ready(function(){$("#updatedAlert").slideDown().slideUp()})});